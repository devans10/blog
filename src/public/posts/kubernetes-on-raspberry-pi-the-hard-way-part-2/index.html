<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Dave Evans">
    <meta name="description" content="Dave Evans&#39; personal website">
    <meta name="keywords" content="blog,devops,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kubernetes on Raspberry Pi, The Hard Way - Part 2"/>
<meta name="twitter:description" content="Certificate creation for Raspberry Pi Kubernetes cluster."/>

    <meta property="og:title" content="Kubernetes on Raspberry Pi, The Hard Way - Part 2" />
<meta property="og:description" content="Certificate creation for Raspberry Pi Kubernetes cluster." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.daveevans.us/posts/kubernetes-on-raspberry-pi-the-hard-way-part-2/" />
<meta property="article:published_time" content="2018-10-27T02:00:00+00:00" />
<meta property="article:modified_time" content="2018-10-27T02:00:00+00:00" />


    
      <base href="https://www.daveevans.us/posts/kubernetes-on-raspberry-pi-the-hard-way-part-2/">
    
    <title>
  Kubernetes on Raspberry Pi, The Hard Way - Part 2 · Dave Evans
</title>

    
      <link rel="canonical" href="https://www.daveevans.us/posts/kubernetes-on-raspberry-pi-the-hard-way-part-2/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://www.daveevans.us/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://www.daveevans.us/css/custom.css" />
    

    
    
    <link rel="icon" type="image/png" href="https://www.daveevans.us/img/favicon.ico" sizes="32x32">
    <link rel="icon" type="image/png" href="https://www.daveevans.us/img/favicon.ico" sizes="16x16">

    <meta name="generator" content="Hugo 0.74.3" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.daveevans.us/">
      Dave Evans
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.daveevans.us/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.daveevans.us/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.daveevans.us/projects/">Projects</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Kubernetes on Raspberry Pi, The Hard Way - Part 2</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2018-10-27T02:00:00Z'>
                October 27, 2018
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              7 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://www.daveevans.us/tags/kubernetes/">kubernetes</a>
      <span class="separator">•</span>
    <a href="https://www.daveevans.us/tags/raspberry-pi/">raspberry pi</a></div>

        </div>
      </header>

      <div>
        <p><a href="https://www.daveevans.us/posts/kubernetes-on-raspberry-pi-the-hard-way-part-1/">Kubernetes on Raspberry Pi, The Hard Way - Part 1</a></p>
<p>Now the fun begins&hellip;</p>
<p>After the setup of the raspberry pi servers in part 1, I have the hostnames and IPs in the table below.  We now have to create a CA and certificates for all the different pieces of the cluster.  Then create kubeconfigs for the different components to use to connect to the cluster, and distribute everything out to the nodes.  This seems like a <em>really</em> long post, but you will see that its a lot of rinse and repeat commands.  All the commands below are run on my local machice.</p>
<table>
<thead>
<tr>
<th>Hostname</th>
<th>Public IP</th>
<th>Private IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>k8s-master-1.k8s.daveevans.us</td>
<td>192.168.1.20</td>
<td>10.0.0.10</td>
</tr>
<tr>
<td>k8s-master-2.k8s.daveevans.us</td>
<td>192.168.1.21</td>
<td>10.0.0.11</td>
</tr>
<tr>
<td>k8s-master-3.k8s.daveevans.us</td>
<td>192.168.1.22</td>
<td>10.0.0.12</td>
</tr>
<tr>
<td>k8s-node-1.k8s.daveevans.us</td>
<td>192.168.1.23</td>
<td>10.0.0.13</td>
</tr>
<tr>
<td>k8s-node-2.k8s.daveevans.us</td>
<td>192.168.1.24</td>
<td>10.0.0.14</td>
</tr>
<tr>
<td>k8s-node-3.k8s.daveevans.us</td>
<td>192.168.1.25</td>
<td>10.0.0.15</td>
</tr>
<tr>
<td>kubernetes.k8s.daveevans.us</td>
<td>192.168.1.26</td>
<td>10.0.0.16</td>
</tr>
</tbody>
</table>
<h3 id="setup-our-local-machine">Setup our local machine</h3>
<p>First, we need to install cfssl which will be used to create all the certificates that we will create.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ wget -q --show-progress --https-only --timestamping <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
$ chmod +x cfssl_linux-amd64 cfssljson_linux-amd64
$ sudo mv cfssl_linux-amd64 /usr/local/bin/cfssl
$ sudo mv cfssljson_linux-amd64 /usr/local/bin/cfssljson
$ cfssl version
</code></pre></div><p>Next, we have to install kubectl that we will use to remotely connect to the cluster later, but in this post we will use it to create the kubeconfigs for the cluster components.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ wget https://storage.googleapis.com/kubernetes-release/release/v1.12.0/bin/linux/amd64/kubectl
$ chmod +x kubectl
$ sudo mv kubectl /usr/local/bin/
$ kubectl version --client
</code></pre></div><h3 id="creating-the-ca-and-cluster-certificates">Creating the CA and cluster certificates.</h3>
<p>Create the CA using the command set below.  You will see a pattern to all these commands.  The first part(s) creates a JSON file that are then fed into the cfssl command to generate the certificates.  I also suggest running these in a seperate directory as it creates a bunch of files.  I created ~/k8s-pi and <code>cd</code> into it</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ {

cat &gt; ca-config.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;signing&#34;: {
</span><span style="font-style:italic">    &#34;default&#34;: {
</span><span style="font-style:italic">      &#34;expiry&#34;: &#34;8760h&#34;
</span><span style="font-style:italic">    },
</span><span style="font-style:italic">    &#34;profiles&#34;: {
</span><span style="font-style:italic">      &#34;kubernetes&#34;: {
</span><span style="font-style:italic">        &#34;usages&#34;: [&#34;signing&#34;, &#34;key encipherment&#34;, &#34;server auth&#34;, &#34;client auth&#34;],
</span><span style="font-style:italic">        &#34;expiry&#34;: &#34;8760h&#34;
</span><span style="font-style:italic">      }
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  }
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cat &gt; ca-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;Kubernetes&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;Kubernetes&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;CA&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert -initca ca-csr.json | cfssljson -bare ca

}
</code></pre></div><p>Create Admin certificates which will be used to connect remotely to the cluster.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">{

cat &gt; admin-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;admin&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;system:masters&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  admin-csr.json | cfssljson -bare admin

}
</code></pre></div><p>Create API Server Certs.  Below we first set a <code>CERT_HOSTNAME</code> environment variable that lists all the IPs and hostnames that could be used to connect to the API servers.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ CERT_HOSTNAME=10.32.0.1,10.0.0.10,k8s-master-1.k8s.daveevans.us,10.0.0.11,k8s-master-2.k8s.daveevans.us,10.0.0.12,k8s-master-3.k8s.daveevans.us,127.0.0.1,localhost,kubernetes.default


$ {

cat &gt; kubernetes-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;kubernetes&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;Kubernetes&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -hostname=<span style="font-weight:bold;font-style:italic">${</span>CERT_HOSTNAME<span style="font-weight:bold;font-style:italic">}</span> <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  kubernetes-csr.json | cfssljson -bare kubernetes

}
</code></pre></div><p>Create Controller Certs</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ {

cat &gt; kube-controller-manager-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;system:kube-controller-manager&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;system:kube-controller-manager&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager

}
</code></pre></div><p>Create Scheduler Certs</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ {

cat &gt; kube-scheduler-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;system:kube-scheduler&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;system:kube-scheduler&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  kube-scheduler-csr.json | cfssljson -bare kube-scheduler

}
</code></pre></div><p>Create Client Certificates.  We create environment variables that list the hostname and IPs of the worker nodes, then create the certificates for each node.  One important note, we are using the private IP address that was setup on the second virtual address for all the IP connectivity.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ WORKER0_HOST=k8s-node-1.k8s.daveevans.us
$ WORKER0_IP=10.0.0.13
$ WORKER1_HOST=k8s-node-2.k8s.daveevans.us
$ WORKER1_IP=10.0.0.14
$ WORKER2_HOST=k8s-node-3.k8s.daveevans.us
$ WORKER2_IP=10.0.0.15

$ {
cat &gt; <span style="font-weight:bold;font-style:italic">${</span>WORKER0_HOST<span style="font-weight:bold;font-style:italic">}</span>-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;system:node:${WORKER0_HOST}&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;system:nodes&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -hostname=<span style="font-weight:bold;font-style:italic">${</span>WORKER0_IP<span style="font-weight:bold;font-style:italic">}</span>,<span style="font-weight:bold;font-style:italic">${</span>WORKER0_HOST<span style="font-weight:bold;font-style:italic">}</span> <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  <span style="font-weight:bold;font-style:italic">${</span>WORKER0_HOST<span style="font-weight:bold;font-style:italic">}</span>-csr.json | cfssljson -bare <span style="font-weight:bold;font-style:italic">${</span>WORKER0_HOST<span style="font-weight:bold;font-style:italic">}</span>

cat &gt; <span style="font-weight:bold;font-style:italic">${</span>WORKER1_HOST<span style="font-weight:bold;font-style:italic">}</span>-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;system:node:${WORKER1_HOST}&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;system:nodes&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -hostname=<span style="font-weight:bold;font-style:italic">${</span>WORKER1_IP<span style="font-weight:bold;font-style:italic">}</span>,<span style="font-weight:bold;font-style:italic">${</span>WORKER1_HOST<span style="font-weight:bold;font-style:italic">}</span> <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  <span style="font-weight:bold;font-style:italic">${</span>WORKER1_HOST<span style="font-weight:bold;font-style:italic">}</span>-csr.json | cfssljson -bare <span style="font-weight:bold;font-style:italic">${</span>WORKER1_HOST<span style="font-weight:bold;font-style:italic">}</span>

cat &gt; <span style="font-weight:bold;font-style:italic">${</span>WORKER2_HOST<span style="font-weight:bold;font-style:italic">}</span>-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;system:node:${WORKER2_HOST}&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;system:nodes&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -hostname=<span style="font-weight:bold;font-style:italic">${</span>WORKER2_IP<span style="font-weight:bold;font-style:italic">}</span>,<span style="font-weight:bold;font-style:italic">${</span>WORKER2_HOST<span style="font-weight:bold;font-style:italic">}</span> <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  <span style="font-weight:bold;font-style:italic">${</span>WORKER2_HOST<span style="font-weight:bold;font-style:italic">}</span>-csr.json | cfssljson -bare <span style="font-weight:bold;font-style:italic">${</span>WORKER2_HOST<span style="font-weight:bold;font-style:italic">}</span>
}
</code></pre></div><p>Create Proxy Certificate</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">{

cat &gt; kube-proxy-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;system:kube-proxy&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;system:node-proxier&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  kube-proxy-csr.json | cfssljson -bare kube-proxy

}
</code></pre></div><p>Create Service Key Pair</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ {

cat &gt; service-account-csr.json <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">{
</span><span style="font-style:italic">  &#34;CN&#34;: &#34;service-accounts&#34;,
</span><span style="font-style:italic">  &#34;key&#34;: {
</span><span style="font-style:italic">    &#34;algo&#34;: &#34;rsa&#34;,
</span><span style="font-style:italic">    &#34;size&#34;: 2048
</span><span style="font-style:italic">  },
</span><span style="font-style:italic">  &#34;names&#34;: [
</span><span style="font-style:italic">    {
</span><span style="font-style:italic">      &#34;C&#34;: &#34;US&#34;,
</span><span style="font-style:italic">      &#34;L&#34;: &#34;Pittsburgh&#34;,
</span><span style="font-style:italic">      &#34;O&#34;: &#34;Kubernetes&#34;,
</span><span style="font-style:italic">      &#34;OU&#34;: &#34;Kubernetes The Hard Way&#34;,
</span><span style="font-style:italic">      &#34;ST&#34;: &#34;Pennsylvania&#34;
</span><span style="font-style:italic">    }
</span><span style="font-style:italic">  ]
</span><span style="font-style:italic">}
</span><span style="font-style:italic">EOF</span>

cfssl gencert <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -ca-key=ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -config=ca-config.json <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  -profile=kubernetes <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>  service-account-csr.json | cfssljson -bare service-account

}
</code></pre></div><p>Create Encryption Key</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ENCRYPTION_KEY=<span style="font-weight:bold">$(</span>head -c 32 /dev/urandom | base64<span style="font-weight:bold">)</span>

$ cat &gt; encryption-config.yaml <span style="font-style:italic">&lt;&lt; EOF
</span><span style="font-style:italic">kind: EncryptionConfig
</span><span style="font-style:italic">apiVersion: v1
</span><span style="font-style:italic">resources:
</span><span style="font-style:italic">  - resources:
</span><span style="font-style:italic">      - secrets
</span><span style="font-style:italic">    providers:
</span><span style="font-style:italic">      - aescbc:
</span><span style="font-style:italic">          keys:
</span><span style="font-style:italic">            - name: key1
</span><span style="font-style:italic">              secret: ${ENCRYPTION_KEY}
</span><span style="font-style:italic">      - identity: {}
</span><span style="font-style:italic">EOF</span>
</code></pre></div><p>Create Admin kubeconfig using the CA and Admin certs we just created.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">{
  kubectl config set-cluster kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --certificate-authority=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --server=https://127.0.0.1:6443 <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=admin.kubeconfig

  kubectl config set-credentials admin <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-certificate=admin.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-key=admin-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=admin.kubeconfig

  kubectl config set-context default <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --cluster=kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --user=admin <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=admin.kubeconfig

  kubectl config use-context default --kubeconfig=admin.kubeconfig
}
</code></pre></div><p>Create kube-controller-manager kubeconfig</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">{
  kubectl config set-cluster kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --certificate-authority=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --server=https://127.0.0.1:6443 <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-controller-manager.kubeconfig

  kubectl config set-credentials system:kube-controller-manager <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-certificate=kube-controller-manager.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-key=kube-controller-manager-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-controller-manager.kubeconfig

  kubectl config set-context default <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --cluster=kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --user=system:kube-controller-manager <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-controller-manager.kubeconfig

  kubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig
}
</code></pre></div><p>Create kube-scheduler kubeconifg</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">{
  kubectl config set-cluster kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --certificate-authority=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --server=https://127.0.0.1:6443 <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-scheduler.kubeconfig

  kubectl config set-credentials system:kube-scheduler <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-certificate=kube-scheduler.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-key=kube-scheduler-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-scheduler.kubeconfig

  kubectl config set-context default <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --cluster=kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --user=system:kube-scheduler <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-scheduler.kubeconfig

  kubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig
}
</code></pre></div><p>Create kube-proxy kubeconfig</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">{
  kubectl config set-cluster kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --certificate-authority=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --server=https://<span style="font-weight:bold;font-style:italic">${</span>KUBERNETES_ADDRESS<span style="font-weight:bold;font-style:italic">}</span>:6443 <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-proxy.kubeconfig

  kubectl config set-credentials system:kube-proxy <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-certificate=kube-proxy.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-key=kube-proxy-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-proxy.kubeconfig

  kubectl config set-context default <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --cluster=kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --user=system:kube-proxy <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=kube-proxy.kubeconfig

  kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig
}
</code></pre></div><p>Create the worker node kubeconfigs.  Here a for loop is used to create the individual kubeconfigs for each of the nodes.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="font-weight:bold">for</span> instance in k8s-node-1.k8s.daveevans.us k8s-node-2.k8s.daveevans.us k8s-node-3.k8s.daveevans.us; <span style="font-weight:bold">do</span>
  kubectl config set-cluster kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --certificate-authority=ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --server=https://<span style="font-weight:bold;font-style:italic">${</span>KUBERNETES_ADDRESS<span style="font-weight:bold;font-style:italic">}</span>:6443 <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span>.kubeconfig

  kubectl config set-credentials system:node:<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span> <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-certificate=<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span>.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --client-key=<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span>-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --embed-certs=true <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span>.kubeconfig

  kubectl config set-context default <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --cluster=kubernetes-the-hard-way <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --user=system:node:<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span> <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>    --kubeconfig=<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span>.kubeconfig

  kubectl config use-context default --kubeconfig=<span style="font-weight:bold;font-style:italic">${</span>instance<span style="font-weight:bold;font-style:italic">}</span>.kubeconfig
<span style="font-weight:bold">done</span>
</code></pre></div><p>Distribute the certs and kubeconfigs</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ scp ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager-key.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kubernetes-key.pem kubernetes.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      admin-key.pem admin.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      admin.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      pi@k8s-master-1.k8s.daveevans.us:~/

$ scp ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager-key.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kubernetes-key.pem kubernetes.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      admin-key.pem admin.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      admin.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      pi@k8s-master-2.k8s.daveevans.us:~/

$ scp ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      ca-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-controller-manager-key.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kubernetes-key.pem kubernetes.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-scheduler.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      admin-key.pem admin.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      admin.kubeconfig <span style="font-weight:bold;font-style:italic">\ </span>
      pi@k8s-master-3.k8s.daveevans.us:~/
      
$ scp kube-proxy-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-proxy.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-proxy.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-1.k8s.daveevans.us-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-1.k8s.daveevans.us.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-1.k8s.daveevans.us.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      pi@k8s-node-1.k8s.daveevans.us:~/
      
$ scp kube-proxy-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-proxy.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-proxy.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-2.k8s.daveevans.us-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-2.k8s.daveevans.us.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-2.k8s.daveevans.us.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      pi@k8s-node-2.k8s.daveevans.us:~/

$ scp kube-proxy-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-proxy.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      kube-proxy.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      ca.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-3.k8s.daveevans.us-key.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-3.k8s.daveevans.us.pem <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      k8s-node-3.k8s.daveevans.us.kubeconfig <span style="font-weight:bold;font-style:italic">\
</span><span style="font-weight:bold;font-style:italic"></span>      pi@k8s-node-3.k8s.daveevans.us:~/
      
</code></pre></div><p><a href="https://www.daveevans.us/posts/kubernetes-on-raspberry-pi-the-hard-way-part-3/">Kubernetes on Raspberry Pi, The Hard Way - Part 3</a></p>

      </div>

      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "www-daveevans-us" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
     © 2020
    
       · 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-124360075-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  </body>

</html>
